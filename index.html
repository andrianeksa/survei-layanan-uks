<!doctype html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Survei Kepuasan UKS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.tailwindcss.com"></script>

<style>
body { font-family: Nunito, sans-serif; }
.option{
  border:2px solid #e5e7eb;
  padding:14px;
  border-radius:16px;
  cursor:pointer;
  transition:.2s;
  background:#fff;
}
.option:hover{ border-color:#22c55e }
.option.active{
  background:#dcfce7;
  border-color:#16a34a;
  color:#166534;
  font-weight:700;
  transform:scale(1.04);
}
.hidden{ display:none }
</style>
</head>

<body class="bg-gradient-to-br from-green-50 via-blue-50 to-lime-50 min-h-screen">

<div class="max-w-xl mx-auto p-6">

<!-- ================= HOME ================= -->
<section id="home">
  <h1 class="text-3xl font-extrabold text-center text-green-700">
    Survei Kepuasan Layanan UKS
  </h1>
  <p class="text-center font-semibold text-blue-700 mb-6">
    MTs Negeri 9 Bantul
  </p>

  <div class="bg-white rounded-3xl shadow-xl p-6 text-center">
    <p class="font-bold text-lg">ğŸ“Š Kepuasan Layanan UKS</p>
    <div class="text-5xl font-extrabold text-green-600 my-3">
      <span id="avgScore">0</span>/100
    </div>
    <p id="statusText"
       class="mt-3 bg-orange-100 text-orange-700 px-3 py-2 rounded-full">
      Dalam proses peningkatan layanan.
    </p>

    <div class="mt-6 text-left text-sm">
      <p class="font-bold mb-2">ğŸ‘¥ Responden</p>
      <div>Guru: <span id="guru">0</span></div>
      <div>Pegawai: <span id="pegawai">0</span></div>
      <div>VII: <span id="vii">0</span> | VIII: <span id="viii">0</span> | IX: <span id="ix">0</span></div>
    </div>

    <button onclick="go('form')"
      class="mt-6 w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-xl font-bold">
      ğŸ¥ Mulai Survei
    </button>
  </div>
</section>

<!-- ================= FORM ================= -->
<section id="form" class="hidden">
  <div class="bg-white rounded-3xl shadow-xl p-6">

    <h2 class="text-xl font-extrabold text-center text-green-700 mb-6">
      ğŸ“‹ Data Responden
    </h2>

    <input id="nama" placeholder="Nama (opsional)"
      class="w-full border-2 rounded-xl p-3 mb-2">

    <p class="text-xs text-gray-500 mb-4">
      Digunakan hanya untuk dokumentasi internal madrasah.
    </p>

    <p class="font-bold mb-2">Status:</p>
    <div id="statusGroup" class="grid grid-cols-3 gap-3 mb-6">
      <div class="option" data-v="Guru">ğŸ‘¨â€ğŸ« Guru</div>
      <div class="option" data-v="Pegawai">ğŸ‘” Pegawai</div>
      <div class="option" data-v="Siswa">ğŸ‘¨â€ğŸ“ Siswa</div>
    </div>

    <div id="kelasBox" class="hidden">
      <p class="font-bold mb-2">Kelas:</p>
      <div id="kelasGroup" class="grid grid-cols-3 gap-3 mb-6">
        <div class="option" data-v="VII">VII</div>
        <div class="option" data-v="VIII">VIII</div>
        <div class="option" data-v="IX">IX</div>
      </div>
    </div>

    <button onclick="startSurvey()"
      class="w-full bg-green-600 text-white py-3 rounded-xl font-bold">
      Lanjutkan â†’
    </button>
  </div>
</section>

<!-- ================= SURVEY ================= -->
<section id="survey" class="hidden">
  <div class="bg-white rounded-3xl shadow-xl p-6">

    <p id="qNum" class="text-sm font-bold text-green-600"></p>
    <h3 id="qText" class="text-lg font-extrabold mt-2 mb-4"></h3>

    <div id="options" class="grid grid-cols-1 gap-3"></div>

    <button id="nextBtn" onclick="nextQ()"
      class="mt-6 w-full bg-green-600 text-white py-3 rounded-xl font-bold disabled:opacity-40"
      disabled>
      Selanjutnya â†’
    </button>
  </div>
</section>

<!-- ================= SARAN ================= -->
<section id="saran" class="hidden">
  <div class="bg-white rounded-3xl shadow-xl p-6">

    <h2 class="text-xl font-extrabold text-center text-green-700 mb-4">
      ğŸ’¬ Saran & Masukan
    </h2>

    <p class="text-sm text-gray-600 mb-3 text-center">
      Silakan tuliskan saran untuk peningkatan layanan UKS (opsional).
    </p>

    <textarea id="saranText"
      rows="5"
      class="w-full border-2 rounded-xl p-3"
      placeholder="Contoh: Ruang UKS sudah nyaman, tetapi perlu penambahan kipas angin."></textarea>

    <button onclick="submitSurvey()"
      class="mt-5 w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-xl font-bold">
      Kirim Survei âœ“
    </button>
  </div>
</section>

</div>

<!-- ===== FIREBASE UMD ===== -->
<script src="https://www.gstatic.com/firebasejs/10.15.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.15.0/firebase-database.js"></script>

<script>
/* ===== FIREBASE CONFIG ===== */
const firebaseConfig = {
  apiKey: "API_KEY",
  authDomain: "PROJECT_ID.firebaseapp.com",
  databaseURL: "https://PROJECT_ID-default-rtdb.firebaseio.com",
  projectId: "PROJECT_ID",
  storageBucket: "PROJECT_ID.appspot.com",
  messagingSenderId: "SENDER_ID",
  appId: "APP_ID"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ===== DATA SURVEI ===== */
const questions=[
 'Ruang UKS bersih dan nyaman',
 'Ketersediaan obat dan alat kesehatan',
 'Kecepatan pelayanan UKS',
 'Keramahan petugas UKS',
 'Manfaat layanan UKS bagi warga madrasah'
];

const likert=[
 {v:25,t:'ğŸ˜ Tidak Puas'},
 {v:50,t:'ğŸ˜ Kurang Puas'},
 {v:75,t:'ğŸ˜Š Puas'},
 {v:100,t:'ğŸ˜„ Sangat Puas'}
];

let nama='', role='', kelas='', qi=0, answers=[];

/* ===== NAV ===== */
function go(id){
 ['home','form','survey','saran'].forEach(x=>document.getElementById(x).classList.add('hidden'));
 document.getElementById(id).classList.remove('hidden');
}

/* ===== HOME ===== */
function updateHome(){
  db.ref('survei').once('value',snap=>{
    const d = snap.val();
    if(!d) return;
    const arr = Object.values(d);
    const avgScoreVal = Math.round(arr.reduce((a,b)=>a+b.score,0)/arr.length);
    document.getElementById('avgScore').textContent = avgScoreVal;
    document.getElementById('statusText').textContent = avgScoreVal>=80?'âœ“ Target kepuasan tercapai':'Dalam proses peningkatan layanan';
    document.getElementById('statusText').className = avgScoreVal>=80?
      'mt-3 bg-green-100 text-green-700 px-3 py-2 rounded-full':
      'mt-3 bg-orange-100 text-orange-700 px-3 py-2 rounded-full';

    document.getElementById('guru').textContent=0;
    document.getElementById('pegawai').textContent=0;
    document.getElementById('vii').textContent=0;
    document.getElementById('viii').textContent=0;
    document.getElementById('ix').textContent=0;

    arr.forEach(x=>{
      if(x.role==='Guru') document.getElementById('guru').textContent++;
      if(x.role==='Pegawai') document.getElementById('pegawai').textContent++;
      if(x.role==='Siswa'){
        if(x.kelas==='VII') document.getElementById('vii').textContent++;
        if(x.kelas==='VIII') document.getElementById('viii').textContent++;
        if(x.kelas==='IX') document.getElementById('ix').textContent++;
      }
    });
  });
}
updateHome();

/* ===== FORM ===== */
const statusGroup = document.getElementById('statusGroup');
const kelasGroup = document.getElementById('kelasGroup');
const kelasBox = document.getElementById('kelasBox');

statusGroup.querySelectorAll('.option').forEach(b=>{
  b.onclick=()=>{
    statusGroup.querySelectorAll('.option').forEach(x=>x.classList.remove('active'));
    b.classList.add('active');
    role=b.dataset.v;
    kelasBox.classList.toggle('hidden', role!=='Siswa');
    if(role!=='Siswa') kelas='';
    kelasGroup.querySelectorAll('.option').forEach(x=>x.classList.remove('active'));
  }
});

kelasGroup.querySelectorAll('.option').forEach(b=>{
  b.onclick=()=>{
    kelasGroup.querySelectorAll('.option').forEach(x=>x.classList.remove('active'));
    b.classList.add('active');
    kelas=b.dataset.v;
  }
});

function startSurvey(){
  nama=document.getElementById('nama').value || '-';
  if(!role||(role==='Siswa'&&!kelas)){ alert('Lengkapi data'); return; }
  qi=0; answers=[];
  go('survey'); renderQ();
}

/* ===== SURVEY ===== */
function renderQ(){
  document.getElementById('qNum').textContent = `Pertanyaan ${qi+1} dari ${questions.length}`;
  document.getElementById('qText').textContent = questions[qi];
  const optionsDiv = document.getElementById('options');
  const nextBtn = document.getElementById('nextBtn');
  optionsDiv.innerHTML='';
  nextBtn.disabled=true;

  likert.forEach(l=>{
    const d=document.createElement('div');
    d.className='option';
    d.textContent=l.t;
    d.onclick=()=>{
      optionsDiv.querySelectorAll('.option').forEach(x=>x.classList.remove('active'));
      d.classList.add('active');
      answers[qi]=l.v;
      nextBtn.disabled=false;
    };
    optionsDiv.appendChild(d);
  });

  nextBtn.textContent = qi===questions.length-1?'Lanjutkan â†’':'Selanjutnya â†’';
}

function nextQ(){
  if(qi<questions.length-1){ qi++; renderQ(); }
  else go('saran');
}

/* ===== SUBMIT ===== */
function submitSurvey(){
  const score=Math.round(answers.reduce((a,b)=>a+b,0)/answers.length);
  const saran=document.getElementById('saranText').value;

  const data = {
    nama, role, kelas, score, saran,
    timestamp: new Date().toLocaleString()
  };

  firebase.database().ref('survei').push(data, err=>{
    if(err) alert('Gagal mengirim survei');
    else{
      alert('Survei berhasil dikirim âœ…');
      document.getElementById('saranText').value='';
      updateHome();
      go('home');
    }
  });
}
</script>

</body>
</html>
