<!doctype html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Survei Layanan UKS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.tailwindcss.com"></script>
<style>
body { font-family: Nunito, sans-serif; }
.option{
  border:2px solid #e5e7eb; padding:14px; border-radius:16px; cursor:pointer; transition:.2s; background:#fff;
}
.option:hover{ border-color:#22c55e }
.option.active{ background:#dcfce7; border-color:#16a34a; color:#166534; font-weight:700; transform:scale(1.04);}
.hidden{ display:none }
.disabled { opacity:0.4; cursor:not-allowed }
</style>
</head>
<body class="bg-gradient-to-br from-green-50 via-blue-50 to-lime-50 min-h-screen">
<div class="max-w-xl mx-auto p-6">

<!-- HOME -->
<section id="home">
  <h1 class="text-3xl font-extrabold text-center text-green-700">Survei Kepuasan Layanan UKS</h1>
  <p class="text-center font-semibold text-blue-700 mb-6">MTs Negeri 9 Bantul</p>
  <div class="bg-white rounded-3xl shadow-xl p-6 text-center">
    <p class="font-bold text-lg">ğŸ“Š Kepuasan Layanan UKS</p>
    <div class="text-5xl font-extrabold text-green-600 my-3"><span id="avgScore">0</span>/100</div>
    <p id="statusText" class="mt-3 bg-orange-100 text-orange-700 px-3 py-2 rounded-full">Dalam proses peningkatan layanan.</p>
    <div class="mt-6 text-left text-sm">
      <p class="font-bold mb-2">ğŸ‘¥ Responden</p>
      <div>Guru: <span id="guru">0</span></div>
      <div>Pegawai: <span id="pegawai">0</span></div>
      <div>VII: <span id="vii">0</span> | VIII: <span id="viii">0</span> | IX: <span id="ix">0</span></div>
    </div>
    <button onclick="go('form')" class="mt-6 w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-xl font-bold">ğŸ¥ Mulai Survei</button>
  </div>
</section>

<!-- FORM -->
<section id="form" class="hidden">
  <div class="bg-white rounded-3xl shadow-xl p-6">
    <h2 class="text-xl font-extrabold text-center text-green-700 mb-6">ğŸ“‹ Data Responden</h2>
    <input id="nama" placeholder="Nama (opsional)" class="w-full border-2 rounded-xl p-3 mb-2">
    <p class="text-xs text-gray-500 mb-4">Digunakan hanya untuk dokumentasi internal madrasah.</p>
    <p class="font-bold mb-2">Status:</p>
    <div id="statusGroup" class="grid grid-cols-3 gap-3 mb-6">
      <div class="option" data-v="Guru">ğŸ‘¨â€ğŸ« Guru</div>
      <div class="option" data-v="Pegawai">ğŸ‘” Pegawai</div>
      <div class="option" data-v="Siswa">ğŸ‘¨â€ğŸ“ Siswa</div>
    </div>
    <div id="kelasBox" class="hidden">
      <p class="font-bold mb-2">Kelas:</p>
      <div id="kelasGroup" class="grid grid-cols-3 gap-3 mb-6">
        <div class="option" data-v="VII">VII</div>
        <div class="option" data-v="VIII">VIII</div>
        <div class="option" data-v="IX">IX</div>
      </div>
    </div>
    <button onclick="startSurvey()" class="w-full bg-green-600 text-white py-3 rounded-xl font-bold">Lanjutkan â†’</button>
  </div>
</section>

<!-- SURVEY -->
<section id="survey" class="hidden">
  <div class="bg-white rounded-3xl shadow-xl p-6">
    <p id="qNum" class="text-sm font-bold text-green-600"></p>
    <h3 id="qText" class="text-lg font-extrabold mt-2 mb-4"></h3>
    <div id="options" class="grid grid-cols-1 gap-3"></div>
    <button id="nextBtn" onclick="nextQ()" class="mt-6 w-full bg-green-600 text-white py-3 rounded-xl font-bold disabled" disabled>Selanjutnya â†’</button>
  </div>
</section>

<!-- SARAN -->
<section id="saran" class="hidden">
  <div class="bg-white rounded-3xl shadow-xl p-6">
    <h2 class="text-xl font-extrabold text-center text-green-700 mb-4">ğŸ’¬ Saran & Masukan</h2>
    <textarea id="saranText" rows="5" class="w-full border-2 rounded-xl p-3" placeholder="Contoh: Ruang UKS sudah nyaman, tetapi perlu penambahan kipas angin."></textarea>
    <button onclick="submitSurvey()" class="mt-5 w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-xl font-bold">Kirim Survei âœ“</button>
  </div>
</section>

</div>

<script>
const POST_URL = "https://script.google.com/macros/s/AKfycbzIZ0B685neFQrYiZNi95Y-0Kcy-b0bxhTliFyAVCb6hBH7fjVELRBVTiLppFLoFVcv/exec"; // POST submit
const GET_URL  = "https://script.google.com/macros/s/AKfycbzIZ0B685neFQrYiZNi95Y-0Kcy-b0bxhTliFyAVCb6hBH7fjVELRBVTiLppFLoFVcv/exec"; // GET fetch data

const questions=['Ruang UKS bersih dan nyaman','Ketersediaan obat dan alat kesehatan','Kecepatan pelayanan UKS','Keramahan petugas UKS','Manfaat layanan UKS'];
const likert=[{v:25,t:'ğŸ˜ Tidak Puas'},{v:50,t:'ğŸ˜ Kurang Puas'},{v:75,t:'ğŸ˜Š Puas'},{v:100,t:'ğŸ˜„ Sangat Puas'}];

let nama='', role='', kelas='', qi=0, answers=[];

function go(id){
 ['home','form','survey','saran'].forEach(x=>document.getElementById(x).classList.add('hidden'));
 document.getElementById(id).classList.remove('hidden');
 window.scrollTo({top:0, behavior:'smooth'});
}

// Form selection
document.querySelectorAll('#statusGroup .option').forEach(b=>{
 b.onclick=()=>{
   document.querySelectorAll('#statusGroup .option').forEach(x=>x.classList.remove('active'));
   b.classList.add('active'); role=b.dataset.v;
   document.getElementById('kelasBox').classList.toggle('hidden', role!=='Siswa');
 };
});
document.querySelectorAll('#kelasGroup .option').forEach(b=>{
 b.onclick=()=>{
   document.querySelectorAll('#kelasGroup .option').forEach(x=>x.classList.remove('active'));
   b.classList.add('active'); kelas=b.dataset.v;
 };
});

function startSurvey(){
 nama=document.getElementById('nama').value||'-';
 if(!role||(role==='Siswa'&&!kelas)){ alert('Lengkapi data'); return; }
 qi=0; answers=[]; go('survey'); renderQ();
}

// Survey
function renderQ(){
 document.getElementById('qNum').textContent=`Pertanyaan ${qi+1} dari ${questions.length}`;
 document.getElementById('qText').textContent=questions[qi];
 const optionsDiv=document.getElementById('options');
 optionsDiv.innerHTML='';
 document.getElementById('nextBtn').disabled=true; document.getElementById('nextBtn').classList.add('disabled');
 likert.forEach(l=>{
   const d=document.createElement('div');
   d.className='option'; d.textContent=l.t;
   d.onclick=()=>{
     optionsDiv.querySelectorAll('.option').forEach(x=>x.classList.remove('active'));
     d.classList.add('active'); answers[qi]=l.v;
     document.getElementById('nextBtn').disabled=false;
     document.getElementById('nextBtn').classList.remove('disabled');
   };
   optionsDiv.appendChild(d);
 });
 document.getElementById('nextBtn').textContent = qi===questions.length-1 ? 'Selesai â†’' : 'Selanjutnya â†’';
}

function nextQ(){ if(qi<questions.length-1){ qi++; renderQ(); } else go('saran'); }

// Submit
function submitSurvey(){
 const score = Math.round(answers.reduce((a,b)=>a+b,0)/answers.length);
 const saran = document.getElementById('saranText').value;
 const data={nama,role,kelas,score,saran};

 fetch(POST_URL,{ method:"POST", headers:{ "Content-Type":"application/json"}, body:JSON.stringify(data)})
 .then(res=>res.json())
 .then(resp=>{ if(resp.status==='ok'){ alert("Survei berhasil dikirim!"); document.getElementById('saranText').value=''; fetchAndUpdateHome(); go('home'); } else alert("Gagal kirim survei: "+resp.message); })
 .catch(err=>alert("Gagal kirim survei: "+err));
}

// Fetch data dari Sheet
async function fetchAndUpdateHome(){
 try{
   const res = await fetch(GET_URL);
   const d = await res.json();
   if(!d.length) return;
   let avg=Math.round(d.reduce((a,b)=>a+b.score,0)/d.length);
   document.getElementById('avgScore').textContent=avg;
   document.getElementById('statusText').textContent=avg>=80?'âœ“ Target kepuasan tercapai':'Dalam proses peningkatan layanan';
   document.getElementById('statusText').className=avg>=80?'mt-3 bg-green-100 text-green-700 px-3 py-2 rounded-full':'mt-3 bg-orange-100 text-orange-700 px-3 py-2 rounded-full';

   let guru=0,pegawai=0,vii=0,viii=0,ix=0;
   d.forEach(x=>{ if(x.role==='Guru') guru++; if(x.role==='Pegawai') pegawai++; if(x.role==='Siswa'){ if(x.kelas==='VII') vii++; if(x.kelas==='VIII') viii++; if(x.kelas==='IX') ix++; }});
   document.getElementById('guru').textContent=guru;
   document.getElementById('pegawai').textContent=pegawai;
   document.getElementById('vii').textContent=vii;
   document.getElementById('viii').textContent=viii;
   document.getElementById('ix').textContent=ix;

 }catch(err){ console.error(err); }
}

// Load home data saat halaman dibuka
fetchAndUpdateHome();
</script>
</body>
</html>
