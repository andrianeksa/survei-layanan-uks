<!doctype html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Admin Survei UKS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.tailwindcss.com"></script>
<style>
body { font-family: Nunito, sans-serif; }
table { border-collapse: collapse; width: 100%; }
th, td { border: 1px solid #e5e7eb; padding: 8px; text-align: center; }
th { background-color: #d1fae5; }
</style>
</head>
<body class="bg-green-50 min-h-screen p-6">

<h1 class="text-3xl font-extrabold text-center text-green-700 mb-6">Admin Survei UKS</h1>

<div class="max-w-4xl mx-auto bg-white rounded-3xl shadow-xl p-6">
  <h2 class="text-xl font-bold mb-4">üìä Statistik Ringkas</h2>
  <div class="grid grid-cols-2 gap-4 mb-6">
    <div>Jumlah Guru: <span id="guru">0</span></div>
    <div>Jumlah Pegawai: <span id="pegawai">0</span></div>
    <div>Jumlah Siswa VII: <span id="vii">0</span></div>
    <div>Jumlah Siswa VIII: <span id="viii">0</span></div>
    <div>Jumlah Siswa IX: <span id="ix">0</span></div>
    <div>Rata-rata Skor: <span id="avgScore">0</span></div>
  </div>

  <h2 class="text-xl font-bold mb-4">üìã Detail Responden</h2>
  <table id="tableResponden">
    <thead>
      <tr>
        <th>No</th>
        <th>Nama</th>
        <th>Role</th>
        <th>Kelas</th>
        <th>Score</th>
        <th>Saran</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <button id="downloadBtn" class="mt-6 w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-xl font-bold">
    ‚¨áÔ∏è Download CSV
  </button>
</div>

<script>
// Ambil data dari localStorage
const d = JSON.parse(localStorage.getItem('uks')||'[]');

// Update statistik
let guru=0, pegawai=0, vii=0, viii=0, ix=0, avg=0;
if(d.length>0){
  let totalScore = 0;
  d.forEach(x=>{
    totalScore += x.score;
    if(x.role==='Guru') guru++;
    if(x.role==='Pegawai') pegawai++;
    if(x.role==='Siswa'){
      if(x.kelas==='VII') vii++;
      if(x.kelas==='VIII') viii++;
      if(x.kelas==='IX') ix++;
    }
  });
  avg = Math.round(totalScore/d.length);
}

document.getElementById('guru').textContent = guru;
document.getElementById('pegawai').textContent = pegawai;
document.getElementById('vii').textContent = vii;
document.getElementById('viii').textContent = viii;
document.getElementById('ix').textContent = ix;
document.getElementById('avgScore').textContent = avg;

// Render tabel
const tbody = document.querySelector('#tableResponden tbody');
d.forEach((x,i)=>{
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td>${i+1}</td>
    <td>${x.nama}</td>
    <td>${x.role}</td>
    <td>${x.kelas}</td>
    <td>${x.score}</td>
    <td>${x.saran}</td>
  `;
  tbody.appendChild(tr);
});

// Download CSV
document.getElementById('downloadBtn').onclick = ()=>{
  if(d.length===0){ alert('Belum ada data untuk di-download'); return; }
  let csv = "No,Nama,Role,Kelas,Score,Saran\n";
  d.forEach((x,i)=>{
    csv += `${i+1},"${x.nama}","${x.role}","${x.kelas}",${x.score},"${x.saran}"\n`;
  });
  const blob = new Blob([csv], {type:'text/csv'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'responden_uks.csv';
  a.click();
  URL.revokeObjectURL(url);
};
</script>

</body>
</html>
